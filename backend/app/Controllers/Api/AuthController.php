<?php\nnamespace App\Controllers\Api;\n\nuse App\Models\UserModel;\nuse CodeIgniter\RESTful\ResourceController;\nuse Firebase\\JWT\\JWT;\n\nclass AuthController extends ResourceController {\n    protected $format = 'json';\n\n    public function login() {\n        $data = $this->request->getJSON(true);\n        if (empty($data['username']) || empty($data['password'])) {\n            return $this->failValidationError('username and password required');\n        }\n        $userModel = new UserModel();\n        $user = $userModel->where('username', $data['username'])->first();\n        if (!$user) return $this->failNotFound('User not found');\n        if (!password_verify($data['password'], $user['password'])) {\n            return $this->fail('Invalid credentials', 401);\n        }\n        $key = getenv('JWT_SECRET') ?: 'change_this_secret';\n        $payload = [\n            'iss' => base_url(),\n            'iat' => time(),\n            'exp' => time() + 3600*24,\n            'uid' => $user['id'],\n            'role' => $user['role']\n        ];\n        $jwt = JWT::encode($payload, $key, 'HS256');\n        return $this->respond(['token' => $jwt]);\n    }\n}\n